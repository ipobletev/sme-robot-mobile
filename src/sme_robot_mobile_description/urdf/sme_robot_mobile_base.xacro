<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!-- 
    MACRO: MOBILE BASE
    This macro defines the chassis and the 4 wheels.
    Arguments:
      - name: Prefix for the links/joints to avoid naming conflicts
  -->
  <xacro:macro name="mobile_base" params="name">

    <!-- 
      BASE FOOTPRINT
      This is a virtual link that sits on the ground (z=0). 
      It's useful for navigation algorithms to know where the "floor" is relative to the robot.
    -->
    <link name="${name}_footprint"/>

    <joint name="${name}_footprint_joint" type="fixed">
      <parent link="${name}_footprint"/>
      <child link="${name}_chassis"/>
      <origin xyz="0 0 0.1" rpy="0 0 0"/> <!-- Raise chassis 10cm off ground -->
    </joint>

    <!-- 
      CHASSIS LINK
      The main body of the robot.
    -->
    <link name="${name}_chassis">
      <visual>
        <geometry>
          <box size="0.5 0.3 0.1"/> <!-- Length 0.5m, Width 0.3m, Height 0.1m -->
        </geometry>
        <material name="blue">
          <color rgba="0 0 0.8 1"/>
        </material>
      </visual>
      <collision>
        <geometry>
          <box size="0.5 0.3 0.1"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="10.0"/> <!-- Heavy base for stability -->
        <inertia ixx="0.1" ixy="0" ixz="0" iyy="0.1" iyz="0" izz="0.1"/>
      </inertial>
    </link>

    <!-- 
      WHEEL MACRO
      Helper to create 4 identical wheels.
    -->
    <xacro:macro name="wheel" params="prefix x_pos y_pos">
      <link name="${prefix}_wheel">
        <visual>
          <geometry>
            <cylinder radius="0.1" length="0.05"/>
          </geometry>
          <material name="black">
            <color rgba="0 0 0 1"/>
          </material>
        </visual>
        <collision>
          <geometry>
            <cylinder radius="0.1" length="0.05"/>
          </geometry>
        </collision>
        <inertial>
          <mass value="1.0"/>
          <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
        </inertial>
      </link>

      <joint name="${prefix}_wheel_joint" type="continuous">
        <parent link="${name}_chassis"/>
        <child link="${prefix}_wheel"/>
        <!-- Rotate cylinder to be upright for a wheel -->
        <origin xyz="${x_pos} ${y_pos} 0" rpy="-1.5707 0 0"/> 
        <axis xyz="0 0 1"/> <!-- Rotate around the cylinder's Z axis (which is robot's Y) -->
      </joint>
    </xacro:macro>

    <!-- Instantiate 4 wheels -->
    <xacro:wheel prefix="front_left"  x_pos="0.2"  y_pos="0.175"/>
    <xacro:wheel prefix="front_right" x_pos="0.2"  y_pos="-0.175"/>
    <xacro:wheel prefix="rear_left"   x_pos="-0.2" y_pos="0.175"/>
    <xacro:wheel prefix="rear_right"  x_pos="-0.2" y_pos="-0.175"/>

  </xacro:macro>
</robot>
